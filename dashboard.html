<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - Badro Peintre</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background: linear-gradient(to right, #006633, #00cc66);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .algeria-flag {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .flag-inner {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff 33%, #d21034 33%, #d21034 66%, #006233 66%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flag-inner::after {
            content: "✓";
            color: #d21034;
            font-weight: bold;
            font-size: 16px;
        }
        
        .logout-btn {
            background-color: white;
            color: #006633;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: 250px;
            background-color: #004d26;
            color: white;
            padding: 20px 0;
        }
        
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar li {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .sidebar li:hover, .sidebar li.active {
            background-color: #006633;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        h2 {
            color: #006633;
            border-bottom: 2px solid #00cc66;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 12px;
            text-align: right;
        }
        
        th {
            background-color: #f0f9f0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .btn {
            background-color: #006633;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .btn-delete {
            background-color: #cc0000;
        }
        
        .btn-edit {
            background-color: #ff9900;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .card h3 {
            margin-top: 0;
            color: #006633;
        }
        
        .card .number {
            font-size: 24px;
            font-weight: bold;
            color: #00cc66;
        }
        
        /* أنماط رسائل الاتصال */
        .message-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .message-item.unread {
            background-color: #f0f9ff;
            border-left: 4px solid #006633;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .message-sender {
            font-weight: bold;
            color: #006633;
        }
        
        .message-date {
            color: #888;
            font-size: 14px;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .message-content {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .message-contact {
            margin-bottom: 10px;
            color: #555;
        }
        
        .filters {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn.active {
            background-color: #004d26;
        }
        
        .no-messages {
            text-align: center;
            padding: 20px;
            color: #888;
            font-style: italic;
        }
        
        .message-counter {
            margin: 10px 0;
            color: #006633;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="algeria-flag">
                <div class="flag-inner"></div>
            </div>
            <h1>لوحة تحكم Badro Peintre</h1>
        </div>
        <button class="logout-btn" id="logout-btn">تسجيل الخروج</button>
    </header>
    
    <div class="container">
        <div class="sidebar">
            <ul>
                <li class="active" data-section="dashboard">لوحة التحكم الرئيسية</li>
                <li data-section="testimonials">إدارة آراء العملاء</li>
                <li data-section="gallery">إدارة المعرض</li>
                <li data-section="offers">إدارة العروض</li>
                <li data-section="contact">رسائل الاتصال</li>
            </ul>
        </div>
        
        <div class="main-content">
            <!-- قسم لوحة التحكم الرئيسية -->
            <div class="section active" id="dashboard">
                <h2>نظرة عامة</h2>
                <p>مرحباً بك في لوحة تحكم موقع Badro Peintre. من هنا يمكنك إدارة جميع محتويات موقعك.</p>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>آراء العملاء</h3>
                        <p class="number" id="testimonials-count">6</p>
                        <p>تقييم مضافة</p>
                    </div>
                    <div class="card">
                        <h3>صور المعرض</h3>
                        <p class="number" id="gallery-count">6</p>
                        <p>صورة مضافة</p>
                    </div>
                    <div class="card">
                        <h3>العروض</h3>
                        <p class="number" id="offers-count">3</p>
                        <p>عرض نشط</p>
                    </div>
                    <div class="card">
                        <h3>رسائل الاتصال</h3>
                        <p class="number" id="messages-count">0</p>
                        <p>رسالة جديدة</p>
                    </div>
                </div>
            </div>
            
            <!-- قسم إدارة آراء العملاء -->
            <div class="section" id="testimonials">
                <h2>إدارة آراء العملاء</h2>
                <button class="btn" id="add-testimonial-btn">إضافة رأي جديد</button>
                
                <div id="testimonial-form" style="display: none; margin-top: 20px;">
                    <h3>إضافة/تعديل رأي</h3>
                    <div class="form-group">
                        <label>اسم العميل:</label>
                        <input type="text" id="testimonial-name">
                    </div>
                    <div class="form-group">
                        <label>المكان:</label>
                        <input type="text" id="testimonial-location">
                    </div>
                    <div class="form-group">
                        <label>التعليق:</label>
                        <textarea id="testimonial-comment" rows="4"></textarea>
                    </div>
                    <button class="btn" id="save-testimonial">حفظ</button>
                    <button class="btn" id="cancel-testimonial">إلغاء</button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>المكان</th>
                            <th>التعليق</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="testimonials-table">
                        <!-- سيتم ملء هذا الجدول عبر JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- قسم إدارة المعرض -->
            <div class="section" id="gallery">
                <h2>إدارة معرض الصور</h2>
                <button class="btn" id="add-image-btn">إضافة صورة جديدة</button>
                
                <div id="image-form" style="display: none; margin-top: 20px;">
                    <h3>إضافة صورة جديدة</h3>
                    <div class="form-group">
                        <label>رفع صورة:</label>
                        <input type="file" id="gallery-image">
                    </div>
                    <div class="form-group">
                        <label>وصف الصورة (اختياري):</label>
                        <input type="text" id="image-description">
                    </div>
                    <button class="btn" id="save-image">حفظ</button>
                    <button class="btn" id="cancel-image">إلغاء</button>
                </div>
                
                <div id="gallery-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <!-- سيتم عرض الصور هنا عبر JavaScript -->
                </div>
            </div>
            
            <!-- قسم إدارة العروض -->
            <div class="section" id="offers">
                <h2>إدارة العروض</h2>
                <button class="btn" id="add-offer-btn">إضافة عرض جديد</button>
                
                <div id="offer-form" style="display: none; margin-top: 20px;">
                    <h3>إضافة/تعديل عرض</h3>
                    <div class="form-group">
                        <label>عنوان العرض:</label>
                        <input type="text" id="offer-title">
                    </div>
                    <div class="form-group">
                        <label>وصف العرض:</label>
                        <textarea id="offer-description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>حالة العرض:</label>
                        <select id="offer-status">
                            <option value="active">نشط</option>
                            <option value="inactive">غير نشط</option>
                        </select>
                    </div>
                    <button class="btn" id="save-offer">حفظ</button>
                    <button class="btn" id="cancel-offer">إلغاء</button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>العنوان</th>
                            <th>الوصف</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="offers-table">
                        <!-- سيتم ملء هذا الجدول عبر JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- قسم رسائل الاتصال -->
            <div class="section" id="contact">
                <h2>رسائل الاتصال</h2>
                
                <div class="filters">
                    <button class="btn filter-btn active" data-filter="all">الكل</button>
                    <button class="btn filter-btn" data-filter="unread">غير المقروءة</button>
                    <button class="btn filter-btn" data-filter="read">المقروءة</button>
                    <button class="btn btn-delete" id="delete-all-btn">حذف الكل</button>
                </div>
                
                <div id="messages-container">
                    <!-- سيتم عرض الرسائل هنا عبر JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // التحقق من حالة تسجيل الدخول
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
        
        // بيانات التخزين المحلي
        let testimonials = JSON.parse(localStorage.getItem('testimonials')) || [
            {id: 1, name: "علي السعيدي", location: "بوفاريك", comment: "خويا بدرو الله يحفظك سلكتني قبل عرسي خدمة الله يبارك خويا"},
            {id: 2, name: "احلام احلام", location: "سيدي عبد الله", comment: "شكرا اخي يعطيك صحيحتك خدمتك متقونة وراك ساعدتنا مليح ربي يجازيك خير الجزاء."},
            {id: 3, name: "kamel boraoui", location: "baba ahcen", comment: "badro frr mrc bqp bon travail et bon chance kho."},
            {id: 4, name: "anianoitta", location: "blida", comment: "bravo badro top de top toujour fooor."},
            {id: 5, name: "عيسى الجزائري", location: "عمروصة", comment: "روح راك رابح بدرو خويا خدمة ربي يبارك راصوفيتلي الحيوط مالبلاطر هذا والله كنت رايح لخسارة كبيرة ربي بعثك ليا الله يسترك."},
            {id: 6, name: "أمي جنتي", location: "اولاد يعيش", comment: "شكرا خويا تستهل الدعم خدمة ما شاء الله كيما تقول العمل والاتقان"}
        ];
        
        let gallery = JSON.parse(localStorage.getItem('gallery')) || [
            {id: 1, src: "https://via.placeholder.com/300x200/006633/ffffff?text=عمل+الدهان", description: "عمل الدهان"},
            {id: 2, src: "https://via.placeholder.com/300x200/00cc66/ffffff?text=طلاء+جديد", description: "طلاء جديد"},
            {id: 3, src: "https://via.placeholder.com/300x200/004d26/ffffff?text=تشطيبات", description: "تشطيبات"},
            {id: 4, src: "https://via.placeholder.com/300x200/ffcc00/000000?text=ألوان+متنوعة", description: "ألوان متنوعة"},
            {id: 5, src: "https://via.placeholder.com/300x200/ffffff/006633?text=ديكورات", description: "ديكورات"},
            {id: 6, src: "https://via.placeholder.com/300x200/cccccc/006633?text=أعمالنا", description: "أعمالنا"}
        ];
        
        let offers = JSON.parse(localStorage.getItem('offers')) || [
            {id: 1, title: "عرض الدهان الداخلي", description: "خصم 20% على خدمات الدهان الداخلي للمساحات الكبيرة", status: "active"},
            {id: 2, title: "عرض الصيف", description: "خصم 15% على الدهان الخارجي خلال فصل الصيف", status: "active"},
            {id: 3, title: "عرض خاص للعملاء الجدد", description: "استشارة مجانية وتقدير مجاني للتكلفة", status: "active"}
        ];
        
        // عناصر القائمة الجانبية
        const menuItems = document.querySelectorAll('.sidebar li');
        const sections = document.querySelectorAll('.section');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-section');
                
                // إزالة النشاط من جميع العناصر
                menuItems.forEach(i => i.classList.remove('active'));
                sections.forEach(s => s.classList.remove('active'));
                
                // إضافة النشاط للعنصر المحدد
                this.classList.add('active');
                document.getElementById(sectionId).classList.add('active');
                
                // تحديث الإحصائيات عند النقر على لوحة التحكم
                if (sectionId === 'dashboard') {
                    updateDashboardStats();
                }
                
                // إذا كان قسم الرسائل، فعرض الرسائل
                if (sectionId === 'contact') {
                    displayMessages();
                }
            });
        });
        
        // تحديث إحصائيات لوحة التحكم
        function updateDashboardStats() {
            const messages = JSON.parse(localStorage.getItem('contactMessages')) || [];
            const unreadCount = messages.filter(m => !m.read).length;
            
            document.getElementById('testimonials-count').textContent = testimonials.length;
            document.getElementById('gallery-count').textContent = gallery.length;
            document.getElementById('offers-count').textContent = offers.filter(o => o.status === 'active').length;
            document.getElementById('messages-count').textContent = unreadCount;
        }
        
        // تسجيل الخروج
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        });
        
        // تهيئة الصفحة عند التحميل
        window.onload = function() {
            updateDashboardStats();
            displayTestimonials();
            displayGallery();
            displayOffers();
            
            // إعداد مستمعي الأحداث للنماذج
            setupEventListeners();
            
            // إعداد الفلاتر
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    displayMessages(this.getAttribute('data-filter'));
                });
            });
            
            // إعداد زر حذف الكل
            document.getElementById('delete-all-btn').addEventListener('click', deleteAllMessages);
        };
        
        // إعداد مستمعي الأحداث للنماذج
        function setupEventListeners() {
            // آراء العملاء
            document.getElementById('add-testimonial-btn').addEventListener('click', function() {
                document.getElementById('testimonial-form').style.display = 'block';
                // مسح الحقول
                document.getElementById('testimonial-name').value = '';
                document.getElementById('testimonial-location').value = '';
                document.getElementById('testimonial-comment').value = '';
            });
            
            document.getElementById('cancel-testimonial').addEventListener('click', function() {
                document.getElementById('testimonial-form').style.display = 'none';
            });
            
            document.getElementById('save-testimonial').addEventListener('click', saveTestimonial);
            
            // المعرض
            document.getElementById('add-image-btn').addEventListener('click', function() {
                document.getElementById('image-form').style.display = 'block';
            });
            
            document.getElementById('cancel-image').addEventListener('click', function() {
                document.getElementById('image-form').style.display = 'none';
            });
            
            document.getElementById('save-image').addEventListener('click', saveImage);
            
            // العروض
            document.getElementById('add-offer-btn').addEventListener('click', function() {
                document.getElementById('offer-form').style.display = 'block';
                // مسح الحقول
                document.getElementById('offer-title').value = '';
                document.getElementById('offer-description').value = '';
                document.getElementById('offer-status').value = 'active';
            });
            
            document.getElementById('cancel-offer').addEventListener('click', function() {
                document.getElementById('offer-form').style.display = 'none';
            });
            
            document.getElementById('save-offer').addEventListener('click', saveOffer);
        }
        
        // عرض آراء العملاء
        function displayTestimonials() {
            const table = document.getElementById('testimonials-table');
            table.innerHTML = '';
            
            testimonials.forEach(testimonial => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${testimonial.name}</td>
                    <td>${testimonial.location}</td>
                    <td>${testimonial.comment}</td>
                    <td>
                        <button class="btn btn-edit" data-id="${testimonial.id}">تعديل</button>
                        <button class="btn btn-delete" data-id="${testimonial.id}">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editTestimonial(id);
                });
            });
            
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTestimonial(id);
                });
            });
        }
        
        // حفظ رأي العميل
        function saveTestimonial() {
            const name = document.getElementById('testimonial-name').value;
            const location = document.getElementById('testimonial-location').value;
            const comment = document.getElementById('testimonial-comment').value;
            
            if (name && location && comment) {
                const newTestimonial = {
                    id: testimonials.length > 0 ? Math.max(...testimonials.map(t => t.id)) + 1 : 1,
                    name,
                    location,
                    comment
                };
                
                testimonials.push(newTestimonial);
                localStorage.setItem('testimonials', JSON.stringify(testimonials));
                
                document.getElementById('testimonial-form').style.display = 'none';
                displayTestimonials();
                updateDashboardStats();
                
                alert('تم حفظ الرأي بنجاح!');
            } else {
                alert('يرجى ملء جميع الحقول!');
            }
        }
        
        // تعديل رأي العميل
        function editTestimonial(id) {
            const testimonial = testimonials.find(t => t.id === id);
            if (testimonial) {
                document.getElementById('testimonial-form').style.display = 'block';
                document.getElementById('testimonial-name').value = testimonial.name;
                document.getElementById('testimonial-location').value = testimonial.location;
                document.getElementById('testimonial-comment').value = testimonial.comment;
                
                // تغيير وظيفة زر الحفظ للتعديل
                document.getElementById('save-testimonial').onclick = function() {
                    testimonial.name = document.getElementById('testimonial-name').value;
                    testimonial.location = document.getElementById('testimonial-location').value;
                    testimonial.comment = document.getElementById('testimonial-comment').value;
                    
                    localStorage.setItem('testimonials', JSON.stringify(testimonials));
                    document.getElementById('testimonial-form').style.display = 'none';
                    displayTestimonials();
                    
                    // إعادة تعيين وظيفة زر الحفظ
                    document.getElementById('save-testimonial').onclick = saveTestimonial;
                    
                    alert('تم تعديل الرأي بنجاح!');
                };
            }
        }
        
        // حذف رأي العميل
        function deleteTestimonial(id) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذا الرأي؟')) {
                testimonials = testimonials.filter(t => t.id !== id);
                localStorage.setItem('testimonials', JSON.stringify(testimonials));
                displayTestimonials();
                updateDashboardStats();
                
                alert('تم حذف الرأي بنجاح!');
            }
        }
        
        // عرض المعرض
        function displayGallery() {
            const container = document.getElementById('gallery-container');
            container.innerHTML = '';
            
            gallery.forEach(image => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <img src="${image.src}" alt="${image.description}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 5px;">
                    <p>${image.description}</p>
                    <button class="btn btn-delete" data-id="${image.id}">حذف</button>
                `;
                container.appendChild(div);
            });
            
            // إضافة مستمعي الأحداث لأزرار الحذف
            document.querySelectorAll('#gallery-container .btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteImage(id);
                });
            });
        }
        
        // حفظ صورة جديدة
        function saveImage() {
            const fileInput = document.getElementById('gallery-image');
            const description = document.getElementById('image-description').value;
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const newImage = {
                        id: gallery.length > 0 ? Math.max(...gallery.map(g => g.id)) + 1 : 1,
                        src: e.target.result,
                        description: description || 'صورة بدون وصف'
                    };
                    
                    gallery.push(newImage);
                    localStorage.setItem('gallery', JSON.stringify(gallery));
                    
                    document.getElementById('image-form').style.display = 'none';
                    displayGallery();
                    updateDashboardStats();
                    
                    alert('تم حفظ الصورة بنجاح!');
                };
                
                reader.readAsDataURL(file);
            } else {
                alert('يرجى اختيار صورة!');
            }
        }
        
        // حذف صورة
        function deleteImage(id) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذه الصورة؟')) {
                gallery = gallery.filter(g => g.id !== id);
                localStorage.setItem('gallery', JSON.stringify(gallery));
                displayGallery();
                updateDashboardStats();
                
                alert('تم حذف الصورة بنجاح!');
            }
        }
        
        // عرض العروض
        function displayOffers() {
            const table = document.getElementById('offers-table');
            table.innerHTML = '';
            
            offers.forEach(offer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${offer.title}</td>
                    <td>${offer.description}</td>
                    <td>${offer.status === 'active' => 'نشط' : 'غير نشط'}</td>
                    <td>
                        <button class="btn btn-edit" data-id="${offer.id}">تعديل</button>
                        <button class="btn btn-delete" data-id="${offer.id}">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('#offers-table .btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editOffer(id);
                });
            });
            
            document.querySelectorAll('#offers-table .btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteOffer(id);
                });
            });
        }
        
        // حفظ عرض
        function saveOffer() {
            const title = document.getElementById('offer-title').value;
            const description = document.getElementById('offer-description').value;
            const status = document.getElementById('offer-status').value;
            
            if (title && description) {
                const newOffer = {
                    id: offers.length > 0 ? Math.max(...offers.map(o => o.id)) + 1 : 1,
                    title,
                    description,
                    status
                };
                
                offers.push(newOffer);
                localStorage.setItem('offers', JSON.stringify(offers));
                
                document.getElementById('offer-form').style.display = 'none';
                displayOffers();
                updateDashboardStats();
                
                alert('تم حفظ العرض بنجاح!');
            } else {
                alert('يرجى ملء جميع الحقول!');
            }
        }
        
        // تعديل عرض
        function editOffer(id) {
            const offer = offers.find(o => o.id === id);
            if (offer) {
                document.getElementById('offer-form').style.display = 'block';
                document.getElementById('offer-title').value = offer.title;
                document.getElementById('offer-description').value = offer.description;
                document.getElementById('offer-status').value = offer.status;
                
                // تغيير وظيفة زر الحفظ للتعديل
                document.getElementById('save-offer').onclick = function() {
                    offer.title = document.getElementById('offer-title').value;
                    offer.description = document.getElementById('offer-description').value;
                    offer.status = document.getElementById('offer-status').value;
                    
                    localStorage.setItem('offers', JSON.stringify(offers));
                    document.getElementById('offer-form').style.display = 'none';
                    displayOffers();
                    updateDashboardStats();
                    
                    // إعادة تعيين وظيفة زر الحفظ
                    document.getElementById('save-offer').onclick = saveOffer;
                    
                    alert('تم تعديل العرض بنجاح!');
                };
            }
        }
        
        // حذف عرض
        function deleteOffer(id) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذا عرض؟')) {
                offers = offers.filter(o => o.id !== id);
                localStorage.setItem('offers', JSON.stringify(offers));
                displayOffers();
                updateDashboardStats();
                
                alert('تم حذف العرض بنجاح!');
            }
        }
        
        // دالة لعرض رسائل الاتصال
        function displayMessages(filter = 'all') {
            const container = document.getElementById('messages-container');
            container.innerHTML = '';
            
            // الحصول على الرسائل من localStorage
            let messages = JSON.parse(localStorage.getItem('contactMessages')) || [];
            
            // ترتيب الرسائل من الأحدث إلى الأقدم
            messages.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // تطبيق الفلتر إذا كان موجودًا
            if (filter === 'unread') {
                messages = messages.filter(m => !m.read);
            } else if (filter === 'read') {
                messages = messages.filter(m => m.read);
            }
            
            // عرض عداد الرسائل
            const totalMessages = JSON.parse(localStorage.getItem('contactMessages')) || [];
            const unreadCount = totalMessages.filter(m => !m.read).length;
            const counter = document.createElement('div');
            counter.className = 'message-counter';
            counter.innerHTML = `إجمالي الرسائل: ${totalMessages.length} | غير المقروءة: ${unreadCount}`;
            container.appendChild(counter);
            
            if (messages.length === 0) {
                container.innerHTML += '<p class="no-messages">لا توجد رسائل</p>';
                return;
            }
            
            messages.forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.className = `message-item ${message.read ? '' : 'unread'}`;
                messageEl.innerHTML = `
                    <div class="message-header">
                        <div class="message-sender">${message.name} - ${message.email}</div>
                        <div class="message-date">${new Date(message.date).toLocaleString('ar-EG')}</div>
                    </div>
                    <div class="message-contact">
                        <strong>الهاتف:</strong> ${message.phone || 'غير متوفر'}
                    </div>
                    <div class="message-content">
                        <strong>الرسالة:</strong><br>${message.message}
                    </div>
                    <div class="message-actions">
                        ${!message.read ? `<button class="btn mark-read-btn" data-id="${message.id}">تم القراءة</button>` : ''}
                        <button class="btn btn-delete delete-message-btn" data-id="${message.id}">حذف</button>
                    </div>
                `;
                container.appendChild(messageEl);
            });
            
            // إضافة مستمعي الأحداث للأزرار
            document.querySelectorAll('.mark-read-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    markMessageAsRead(id);
                });
            });
            
            document.querySelectorAll('.delete-message-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteMessage(id);
                });
            });
        }
        
        // دالة لتحديد الرسالة كمقروءة
        function markMessageAsRead(id) {
            let messages = JSON.parse(localStorage.getItem('contactMessages')) || [];
            messages = messages.map(message => {
                if (message.id == id) {
                    message.read = true;
                }
                return message;
            });
            
            localStorage.setItem('contactMessages', JSON.stringify(messages));
            displayMessages();
            updateDashboardStats();
        }
        
        // دالة لحذف الرسالة
        function deleteMessage(id) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذه الرسالة؟')) {
                let messages = JSON.parse(localStorage.getItem('contactMessages')) || [];
                messages = messages.filter(message => message.id != id);
                
                localStorage.setItem('contactMessages', JSON.stringify(messages));
                displayMessages();
                updateDashboardStats();
                
                alert('تم حذف الرسالة بنجاح!');
            }
        }
        
        // دالة لحذف جميع الرسائل
        function deleteAllMessages() {
            if (confirm('هل أنت متأكد من أنك تريد حذف جميع الرسائل؟ لا يمكن التراجع عن هذا الإجراء.')) {
                localStorage.removeItem('contactMessages');
                displayMessages();
                updateDashboardStats();
                
                alert('تم حذف جميع الرسائل بنجاح!');
            }
        }
    </script>
</body>
</html>
